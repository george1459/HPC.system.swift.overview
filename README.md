**Note: 12/22 This repo is being constantly updated**

- `xrt_pipeline.sh`

This is the main file for analyzing downloaded SWIFT data, which should be funneled to this file. This file is ran with options `--xrtppl=yes --spec=yes` in its latest depolyment.

When ran in the above configuration, this file will:
  1. Query `/group/phys_heastro/swift/download/4FGL_cpt_hms_new_new.txt` or `/group/phys_heastro/swift/download/4FGL_cpt_deg_new_new.txt` for RA/DEC in either hms or deg format of counterpart information. If no counterpart information in found, use "POINT" as input to `xrtpipeline` in the next step.
  
  2. Run `xrtpipeline` command on all obeservation folders using RA/DEC of counterpart information or "POINT" if no counterpart is found.
  
  3. Process `pc` files, use `xselect` to read all event files in and extract an image. (`xselect` is invoked with a `source` command because `xselect` only supports command-line prompts, same in next steps)
  
  4. Draw **error circle** of **60''** around the location info at step 2,  use **signal-to-noise ratio** of **3** to detect sources in the image by `sosta` command. Note that the error circle of **60''** is only for clarity reason. If we were to draw a circle of **10''**, it sometimes get blurred into a bright source. Thus, a **60''** circle is drawn to make sure we can see where the counterpart location is on the generated photos.
  
  5. Write the identified sources information into folder `source_location`. These will be a collection of `loc_$i.reg` files, where `loc_0.reg` stores the counterpart position. These files will be in a specical format.

  6. **Source filter**: Determine if the distance between the source location and the 4FGL-listed counterpart location is smaller than the uncertainty from X-Ray source detection. This step is done using **xrtcentroid** at https://www.swift.ac.uk/analysis/xrt/xrtcentroid.php. The calculation is done with `distance.py` inside `utils`. **Make sure to have the required python modules installed**. Notice the user on how many sources are left after filter (0, 1, or more).
  
  7. Use `xselect` to again read in all event files, filter on sources selected in the previous step **with the uncertainty from the xrtcentriod source detection**, carry out `extract image`, carry out `extract spec`, carry out `extract curve`, and `filter pha_cutoff` where the endpoints are set at `lccutoff=(30 100 100 200 200 1000)`.
  
  8. Use `ftconvert` to the `im` files generated in step 7 to `txt files`.
  
  9. If the Global spectrum or the particular source spectrum has count rate bigger than 0.5 counts/s, generate a warning.
  
  10. Clean up.
  
This file has a cache feature implemented. If a result from `xrtpipeline` is present, then do not run step 2 of the above procedure.

This file, when ran on HPC, is submitted to its job system through a bunch of `.cmd` files. The `.cmd` files are generated by `jobsubmission.sh`, and they are submitted to the queuing system by `jobtry.sh`.

~~**Note**: For the `UNASSOC` folder, there is a specifically designed `info_point_unassoc.sh` that actually extracts information around each X-Ray source. Use it for anything in `UNASSOC`.~~